on:
  create:
    tags:
      - 'v*'

name: Draft Release

jobs:
   macosbuild:
     name: MacOS Release
     runs-on: macos-latest
     continue-on-error: false
     steps:
       - uses: actions/checkout@v2

       - name: Install MacOS Dependencies
         run: brew update && brew install ffmpeg sfml libarchive curl

       - name: MacOS Package
         run: util/osx/create-pkg.sh

       - name: Upload MacOS Release Asset
         uses: actions/upload-release-asset@v1
         env:
           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
         with:
           upload_url: ${{ needs.draft_release.outputs.upload_url }}
           asset_path: ./attract-*.dmg
           asset_name: attract-*.dmg
           asset_content_type: application/zip
